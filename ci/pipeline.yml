---
jobs:

- name: job-unittest-service
  public: true
  plan:
  - get: fussball-demo
    trigger: true
  - task: unit-test-service
    file: fussball-demo/ci/unit-test-service.yml

- name: job-deploy-service
  public: true
  serial: true
  plan:
  - get: fussball-demo
    passed: [job-unittest-service]
    trigger: true
  - task: build-service
    file: fussball-demo/ci/build-service.yml
  - put: pws
    params:
      manifest: fussball-demo/fussball-service/manifest.yml

- name: job-smoketest-service
  public: true
  plan:
  - get: fussball-demo
    passed: [job-deploy-service]
    trigger: true
  - task: smoke-test-service
    file: fussball-demo/ci/smoke-test-service.yml

- name: job-deploy-www
  public: true
  serial: true
  plan:
  - get: fussball-demo
    trigger: true
  - task: build-www
    file: fussball-demo/ci/build-www.yml
    params:
      GOOGLE_MAPS_API_KEY: ((google-maps-api-key))
  - put: pws
    params:
      manifest: fussball-demo/www/manifest.yml

resources:

- name: fussball-demo
  type: git
  source:
    uri: https://github.com/pvtl-dnoguerol/fussball-demo.git
    branch: master

- name: pws
  type: cf
  source:
    api: https://api.run.pivotal.io
    username: ((pws-username))
    password: ((pws-password))
    organization: ((pws-org))
    space: ((pws-space))
    skip_cert_check: false
